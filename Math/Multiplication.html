import { useState } from 'react';

export default function FancyMultiplicationViz() {
  const [num1, setNum1] = useState(3);
  const [num2, setNum2] = useState(4);
  const [vizType, setVizType] = useState('grid');

  const product = num1 * num2;

  // Grid visualization - classic array
  const renderGrid = () => (
    <div className="space-y-4">
      <p className="text-center text-gray-700 mb-4">
        {num1} rows × {num2} columns = <span className="font-bold text-3xl text-green-600">{product}</span>
      </p>
      <div className="flex justify-center">
        <div className="space-y-2">
          {Array.from({ length: num1 }).map((_, row) => (
            <div key={row} className="flex gap-2">
              {Array.from({ length: num2 }).map((_, col) => (
                <div
                  key={col}
                  className="w-10 h-10 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg shadow-md hover:scale-110 transition-transform flex items-center justify-center text-white font-bold text-sm"
                >
                  {row * num2 + col + 1}
                </div>
              ))}
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  // Area model - shows multiplication as finding area
  const renderArea = () => (
    <div className="space-y-4">
      <p className="text-center text-gray-700 mb-4">
        Area Model: Width × Height = Area
      </p>
      <div className="flex justify-center items-center">
        <div className="relative">
          {/* Main rectangle */}
          <svg width={num2 * 40 + 80} height={num1 * 40 + 80} className="drop-shadow-lg">
            {/* Rectangle */}
            <rect
              x="40"
              y="40"
              width={num2 * 40}
              height={num1 * 40}
              fill="#dbeafe"
              stroke="#0284c7"
              strokeWidth="3"
            />
            
            {/* Grid lines */}
            {Array.from({ length: num1 - 1 }).map((_, i) => (
              <line
                key={`h${i}`}
                x1="40"
                y1={40 + (i + 1) * 40}
                x2={40 + num2 * 40}
                y2={40 + (i + 1) * 40}
                stroke="#cbd5e1"
                strokeWidth="1"
                strokeDasharray="4"
              />
            ))}
            {Array.from({ length: num2 - 1 }).map((_, i) => (
              <line
                key={`v${i}`}
                x1={40 + (i + 1) * 40}
                y1="40"
                x2={40 + (i + 1) * 40}
                y2={40 + num1 * 40}
                stroke="#cbd5e1"
                strokeWidth="1"
                strokeDasharray="4"
              />
            ))}

            {/* Labels */}
            <text
              x={40 + num2 * 20}
              y={30}
              textAnchor="middle"
              className="text-lg font-bold fill-blue-700"
              fontSize="16"
            >
              {num2}
            </text>
            <text
              x={20}
              y={40 + num1 * 20}
              textAnchor="middle"
              dominantBaseline="middle"
              className="text-lg font-bold fill-blue-700"
              fontSize="16"
            >
              {num1}
            </text>

            {/* Area label */}
            <text
              x={40 + num2 * 20}
              y={40 + num1 * 20}
              textAnchor="middle"
              dominantBaseline="middle"
              className="text-2xl font-bold fill-blue-900"
              fontSize="18"
            >
              {product}
            </text>
          </svg>
        </div>
      </div>
      <div className="text-center p-4 bg-blue-100 rounded-lg mt-6">
        <p className="font-bold text-2xl text-blue-900">{num1} × {num2} = {product}</p>
        <p className="text-sm text-blue-700 mt-2">The blue rectangle has an area of {product} square units</p>
      </div>
    </div>
  );

  // Circular groups
  const renderCircles = () => (
    <div className="space-y-4">
      <p className="text-center text-gray-700 mb-4">
        {num1} groups of {num2} = <span className="font-bold text-3xl text-purple-600">{product}</span>
      </p>
      <div className="flex flex-wrap gap-8 justify-center">
        {Array.from({ length: num1 }).map((_, groupIdx) => (
          <div key={groupIdx} className="text-center">
            <p className="text-sm font-semibold text-gray-600 mb-2">Group {groupIdx + 1}</p>
            <div className="flex flex-wrap gap-2 justify-center w-40">
              {Array.from({ length: num2 }).map((_, itemIdx) => (
                <div
                  key={itemIdx}
                  className="w-8 h-8 rounded-full bg-gradient-to-br from-purple-400 to-purple-600 shadow-md hover:scale-125 transition-transform flex items-center justify-center text-white text-xs font-bold"
                >
                  ●
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
      <div className="text-center p-4 bg-purple-100 rounded-lg mt-6">
        <p className="font-bold text-2xl text-purple-900">{num1} × {num2} = {product}</p>
      </div>
    </div>
  );

  // Number line jumps
  const renderNumberLine = () => (
    <div className="space-y-6">
      <p className="text-center text-gray-700">
        Skip counting: Jump {num2} a total of {num1} times
      </p>
      <svg width="100%" height="150" className="drop-shadow-lg">
        {/* Number line */}
        <line x1="20" y1="80" x2={Math.min(980, 20 + product * 30)} y2="80" stroke="#334155" strokeWidth="2" />
        
        {/* Tick marks and numbers */}
        {Array.from({ length: Math.min(product + 1, 33) }).map((_, i) => (
          <g key={i}>
            <line x1={20 + i * 30} y1="75" x2={20 + i * 30} y2="85" stroke="#334155" strokeWidth="2" />
            <text x={20 + i * 30} y="100" textAnchor="middle" fontSize="12" fill="#334155">
              {i * (product / Math.min(product, 32))}
            </text>
          </g>
        ))}

        {/* Jumps */}
        {Array.from({ length: num1 }).map((_, jumpIdx) => {
          const startPos = 20 + jumpIdx * num2 * 30;
          const endPos = 20 + (jumpIdx + 1) * num2 * 30;
          const jumpY = 50 - jumpIdx * 15;
          const colors = ['#ef4444', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'];
          const color = colors[jumpIdx % colors.length];

          return (
            <g key={jumpIdx}>
              {/* Arc */}
              <path
                d={`M ${startPos} 80 Q ${(startPos + endPos) / 2} ${jumpY} ${endPos} 80`}
                fill="none"
                stroke={color}
                strokeWidth="2"
              />
              {/* Label */}
              <text
                x={(startPos + endPos) / 2}
                y={jumpY - 10}
                textAnchor="middle"
                fontSize="14"
                fontWeight="bold"
                fill={color}
              >
                +{num2}
              </text>
            </g>
          );
        })}
      </svg>
      <div className="text-center p-4 bg-orange-100 rounded-lg">
        <p className="font-bold text-2xl text-orange-900">{num1} × {num2} = {product}</p>
        <p className="text-sm text-orange-700 mt-2">0 + {num2} + {num2} + {num2} ... ({num1} times) = {product}</p>
      </div>
    </div>
  );

  // Tree visualization - repeated addition
  const renderTree = () => (
    <div className="space-y-4">
      <p className="text-center text-gray-700 mb-4">
        Repeated Addition: {num2} + {num2} + {num2} ... ({num1} times)
      </p>
      <div className="flex justify-center">
        <svg width="400" height="300" className="drop-shadow-lg">
          {/* Root */}
          <circle cx="200" cy="250" r="25" fill="#ec4899" />
          <text x="200" y="255" textAnchor="middle" dominantBaseline="middle" fontSize="16" fontWeight="bold" fill="white">
            {product}
          </text>

          {/* Branches */}
          {Array.from({ length: num1 }).map((_, i) => {
            const angle = (Math.PI / (num1 + 1)) * (i + 1);
            const x = 200 + Math.cos(angle - Math.PI / 2) * 150;
            const y = 250 - Math.sin(angle - Math.PI / 2) * 150;

            return (
              <g key={i}>
                <line x1="200" y1="250" x2={x} y2={y} stroke="#e879f9" strokeWidth="2" />
                <circle cx={x} cy={y} r="20" fill="#a855f7" />
                <text x={x} y={y} textAnchor="middle" dominantBaseline="middle" fontSize="14" fontWeight="bold" fill="white">
                  {num2}
                </text>
              </g>
            );
          })}
        </svg>
      </div>
      <div className="text-center p-4 bg-pink-100 rounded-lg">
        <p className="font-bold text-2xl text-pink-900">{num1} × {num2} = {product}</p>
        <p className="text-sm text-pink-700 mt-2">{num1} groups of {num2} each</p>
      </div>
    </div>
  );

  const visualizations = {
    grid: renderGrid,
    area: renderArea,
    circles: renderCircles,
    numberline: renderNumberLine,
    tree: renderTree,
  };

  return (
    <div className="w-full max-w-4xl mx-auto p-8 bg-gradient-to-b from-indigo-50 to-purple-50 min-h-screen">
      <h1 className="text-4xl font-bold text-center mb-2 text-indigo-900">
        Fancy Multiplication Visualizations
      </h1>
      <p className="text-center text-gray-700 mb-8">
        Multiple ways to see multiplication!
      </p>

      {/* Visualization type selector */}
      <div className="grid grid-cols-2 md:grid-cols-5 gap-2 mb-8">
        {[
          { id: 'grid', label: 'Grid' },
          { id: 'area', label: 'Area' },
          { id: 'circles', label: 'Groups' },
          { id: 'numberline', label: 'Number Line' },
          { id: 'tree', label: 'Tree' },
        ].map((v) => (
          <button
            key={v.id}
            onClick={() => setVizType(v.id)}
            className={`px-3 py-2 font-semibold rounded-lg transition-all ${
              vizType === v.id
                ? 'bg-indigo-600 text-white shadow-lg scale-105'
                : 'bg-white text-gray-700 border-2 border-gray-300 hover:border-indigo-400'
            }`}
          >
            {v.label}
          </button>
        ))}
      </div>

      {/* Number controls */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 bg-white p-6 rounded-lg">
        <div>
          <label className="block text-sm font-semibold text-gray-700 mb-3">
            First Number: <span className="text-2xl text-indigo-600">{num1}</span>
          </label>
          <div className="flex gap-2 flex-wrap">
            {[1, 2, 3, 4, 5, 6, 7, 8].map((n) => (
              <button
                key={n}
                onClick={() => setNum1(n)}
                className={`px-4 py-2 rounded font-semibold transition-all ${
                  num1 === n
                    ? 'bg-indigo-600 text-white'
                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}
              >
                {n}
              </button>
            ))}
          </div>
        </div>

        <div>
          <label className="block text-sm font-semibold text-gray-700 mb-3">
            Second Number: <span className="text-2xl text-indigo-600">{num2}</span>
          </label>
          <div className="flex gap-2 flex-wrap">
            {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((n) => (
              <button
                key={n}
                onClick={() => setNum2(n)}
                className={`px-4 py-2 rounded font-semibold transition-all ${
                  num2 === n
                    ? 'bg-indigo-600 text-white'
                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}
              >
                {n}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Visualization display */}
      <div className="bg-white p-8 rounded-lg shadow-lg min-h-96">
        {visualizations[vizType]()}
      </div>
    </div>
  );
}
