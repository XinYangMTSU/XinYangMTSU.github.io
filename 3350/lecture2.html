
<section id="ridge-anim">
  <h4>Ridge: Contour Expands to Tangency (Dynamic)</h4>
  <p>
    Press <b>Play</b> to watch the loss contour grow outward from the OLS minimum (★).
    The moment it first <em>touches</em> the L2 circle is the Ridge solution (tangency).
  </p>

  <div style="display:flex; gap:18px; align-items:center; flex-wrap:wrap;">
    <div>
      <!-- Animated SVG -->
      <svg id="ridgeAnimSvg" viewBox="0 0 800 480"
           style="max-width:480px;height:auto;background:#1e1f22;border-radius:12px;box-shadow:0 4px 24px rgba(255,121,198,.12)">
        <defs>
          <marker id="arrow-pink" viewBox="0 0 10 10" refX="8" refY="5"
                  markerWidth="7" markerHeight="7" orient="auto-start-reverse">
            <path d="M0 0 L10 5 L0 10 z" fill="#ff79c6"></path>
          </marker>
          <style>
            .axis{stroke:#ff79c6; stroke-width:2; marker-end:url(#arrow-pink);}
            .axisLabel{fill:#ffb3de; font:500 13px Roboto, Arial, sans-serif;}
            .note{fill:#ffb3de; font:500 12px Roboto, Arial, sans-serif;}
            .label{fill:#ff79c6; font:600 13px Roboto, Arial, sans-serif;}
            .ellipse{fill:none; stroke:#8be9fd; stroke-width:3;}
            .l2{fill:none; stroke:#ff79c6; stroke-width:3;}
          </style>
        </defs>

        <!-- Axes -->
        <g id="coords">
          <line x1="60"  y1="240" x2="760" y2="240" class="axis" />
          <line x1="400" y1="440" x2="400" y2="40"  class="axis" />
          <text x="752" y="226" class="axisLabel">β₁</text>
          <text x="410" y="54"  class="axisLabel">β₂</text>
          <circle cx="400" cy="240" r="2.5" fill="#ff79c6"/>
          <text x="408" y="254" class="note">origin</text>
        </g>

        <!-- Ridge L2 ball (centered at origin (400,240), radius 70) -->
        <g id="l2-ball">
          <circle cx="400" cy="240" r="70" class="l2"/>
          <text x="210" y="356" class="label">L2 constraint: ‖β‖₂ ≤ t</text>
        </g>

        <!-- OLS (unregularized) at (560,160) -->
        <g id="ols">
          <text x="560" y="160" text-anchor="middle" dominant-baseline="middle"
                style="font:700 20px/1 Roboto, Arial, sans-serif; fill:#ffd166;">★</text>
          <text x="572" y="180" class="label">OLS (unregularized)</text>
        </g>

        <!-- One animated SSE contour (ellipse centered on OLS, rotated -25°).
             We animate rx/ry from tiny to the "tangency" size, then freeze. -->
        <g id="animContour" transform="rotate(-25 560 160)">
          <ellipse id="growEllipse" cx="560" cy="160" rx="5" ry="3" class="ellipse">
            <!-- Animate radii: from small to tangency radii (≈ first contact) -->
            <animate id="rxAnim" attributeName="rx" from="5" to="110" dur="2.8s" fill="freeze" begin="indefinite" />
            <animate id="ryAnim" attributeName="ry" from="3" to="72"  dur="2.8s" fill="freeze" begin="indefinite" />
          </ellipse>
        </g>

        <!-- Tangency dot (hidden until we reach the touching level) -->
        <circle id="tangentDot" cx="459.6" cy="210.2" r="6"
                fill="#50fa7b" stroke="#1e1f22" stroke-width="1.5" opacity="0"/>
        <text id="tangentLabel" x="474" y="228" class="label" style="fill:#50fa7b; opacity:0;">
          Ridge solution (tangent)
        </text>
      </svg>
    </div>

    <!-- Controls -->
    <div>
      <button id="btnPlay"  style="padding:.5rem .8rem;border-radius:10px;border:1px solid #ff79c6;background:#21111b;color:#ffb3de;cursor:pointer;">▶ Play</button>
      <button id="btnPause" style="padding:.5rem .8rem;border-radius:10px;border:1px solid #ff79c6;background:#21111b;color:#ffb3de;cursor:pointer;">⏸ Pause</button>
      <button id="btnReset" style="padding:.5rem .8rem;border-radius:10px;border:1px solid #ff79c6;background:#21111b;color:#ffb3de;cursor:pointer;">⟲ Reset</button>

      <p class="note" style="margin-top:.8rem;">
        The ellipse is a level set of SSE centered at ★. It grows until it first touches the circle (‖β‖₂ ≤ t).
      </p>
    </div>
  </div>

  <script>
    (function() {
      const svg = document.getElementById('ridgeAnimSvg');
      const rxAnim = svg.querySelector('#rxAnim');
      const ryAnim = svg.querySelector('#ryAnim');
      const tangentDot = svg.querySelector('#tangentDot');
      const tangentLabel = svg.querySelector('#tangentLabel');

      const btnPlay  = document.getElementById('btnPlay');
      const btnPause = document.getElementById('btnPause');
      const btnReset = document.getElementById('btnReset');

      // Start animation from current state
      btnPlay.addEventListener('click', () => {
        // Start both animations if not already running
        rxAnim.beginElement();
        ryAnim.beginElement();

        // Reveal the tangency point when animation ends
        const showTangent = () => {
          tangentDot.setAttribute('opacity', '1');
          tangentLabel.style.opacity = 1;
          rxAnim.removeEventListener('endEvent', showTangent);
          ryAnim.removeEventListener('endEvent', showTangent);
        };
        rxAnim.addEventListener('endEvent', showTangent);
        ryAnim.addEventListener('endEvent', showTangent);
      });

      // Pause by freezing computed style (SMIL pause is not universally supported);
      // we do a simple hack: get current rx/ry and reset animations to start from there.
      btnPause.addEventListener('click', () => {
        const ellipse = svg.querySelector('#growEllipse');
        const rx = ellipse.getAttribute('rx');
        const ry = ellipse.getAttribute('ry');

        // Reset animations with new from/to = current -> current (freezes)
        rxAnim.setAttribute('from', rx);
        rxAnim.setAttribute('to', rx);
        ryAnim.setAttribute('from', ry);
        ryAnim.setAttribute('to', ry);

        rxAnim.beginElement();
        ryAnim.beginElement();
      });

      // Reset to initial (small ellipse, hide tangency)
      btnReset.addEventListener('click', () => {
        const ellipse = svg.querySelector('#growEllipse');
        ellipse.setAttribute('rx', 5);
        ellipse.setAttribute('ry', 3);

        rxAnim.setAttribute('from', 5);
        rxAnim.setAttribute('to', 110);
        ryAnim.setAttribute('from', 3);
        ryAnim.setAttribute('to', 72);

        tangentDot.setAttribute('opacity', '0');
        tangentLabel.style.opacity = 0;
      });
    })();
  </script>
</section>
