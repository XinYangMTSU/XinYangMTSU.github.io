<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>K-Fold Cross-Validation ¬∑ Pipeline + StandardScaler</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
   body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      background: #17191a;
      min-height: 100vh;
      color: #ff79c6;
      padding: 20px;
    }
    section {
      margin-bottom: 55px;
      background: #222025;
      border-radius: 18px;
      box-shadow: 0 4px 30px rgba(255,121,198,.09);
      padding: 36px 32px 22px 32px;
      border-left: 7px solid #ff79c6;
      position: relative;
      max-width: 950px;
      margin-left: auto;
      margin-right: auto;
    }
    h1 { color:#ffb3de; margin:0 0 8px 0; }
    h2 { margin: 0 0 10px 0; color: #ffb3de; font-weight: 700; }
    section h4 {
      font-size: 1.18em; color: #ffb3de; margin-bottom: 5px; margin-top: 30px;
      font-weight: 600; border-bottom: 1px solid #ffb3de; padding-bottom: 2px;
    }
    p { color:#ffd7f0; }
    pre {
      background: #19121a; color: #ffb3de; padding: 15px 18px; border-radius: 8px;
      font-size: 1.04em; line-height: 1.7; overflow-x: auto;
      box-shadow: 0 2px 10px rgba(255,121,198,0.11); position: relative;
      white-space: pre;
    }
    pre .copy {
      position: absolute; top: 8px; right: 8px; padding: 4px 8px;
      background: #21111b; border: 1px solid #ff79c6; border-radius: 6px;
      color: #ffb3de; font-size: 0.8em; cursor: pointer;
    }
    pre .copy:hover { background: #ff79c6; color: #fff; }
    .pill {
      display:inline-block; background:#19121a; border:1px solid #ff79c6;
      border-radius:999px; padding:4px 10px; margin:2px 8px 2px 0; font-size:.9em
    }
    .note { color:#ffd7f0; opacity:.9; }
    ul { margin-top: 8px; color:#ffd7f0; }
    code.inline { background:#19121a; padding:2px 6px; border-radius:6px; }
    .legend { display:flex; gap:14px; align-items:center; margin:8px 0 18px; }
    .swatch { width:16px; height:16px; border-radius:4px; display:inline-block; border:1px solid #00000033; }
    .swatch.train { background:#6fc3df; }   /* teal-blue */
    .swatch.val   { background:#ff79c6; }   /* pink */
    .svgwrap{ background:#1a151c; border-radius:12px; padding:10px; box-shadow: inset 0 0 0 1px rgba(255,121,198,0.2);}
    .rowlbl{ font-size:0.95em; fill:#ffb3de; }
  </style>
</head>
<body>

<section id="top">
  <center>
    <h1>
      <span class="pill">K-Fold Cross-Validation</span>
    </h1>
  </center>
  <p class="note">
    K-Fold CV splits the training data into <em>K</em> equal parts (‚Äúfolds‚Äù). Each round, one fold is used as the
    <strong>validation</strong> set while the remaining K-1 folds form the <strong>training</strong> set. Results are averaged across folds.
    This gives a more reliable estimate of out-of-sample performance and helps choose hyperparameters (e.g., <code class="inline">alpha</code>).
  </p>

  <p class="note">
  In practice, <strong><font color="red">5-fold</font></strong> and <strong><font color="red">10-fold</font></strong> cross-validation are the most commonly used.
  Five folds give a good balance between bias and variance with reasonable compute cost, while ten folds provide a
  slightly lower bias estimate at the expense of longer training time. Both are widely accepted as standards in applied
  machine learning.
</p>

</section>

<section id="kfold-figure">
  <h2>1) Visual: 5-Fold Cross-Validation</h2>
  <div class="legend">
    <span class="swatch train"></span> <span>Train folds</span>
    <span class="swatch val"></span> <span>Validation fold</span>
  </div>

  <div class="svgwrap">
  <!-- Inline SVG: 5 rows = 5 folds. Each row shows which chunk is validation (pink), others train (blue). -->
  <svg viewBox="0 0 800 240" width="100%" height="auto" role="img" aria-label="Five-fold cross-validation diagram">
    <defs>
      <style>
        .blk { rx:6; ry:6; stroke:#0e0b10; stroke-width:1; }
        .train { fill:#6fc3df; }  /* blue */
        .val { fill:#ff79c6; }    /* pink */
        .lab { fill:#ffb3de; font: 600 14px 'Roboto', Arial, sans-serif; }
        .axis { stroke:#3a2f36; stroke-width:1; }
      </style>
    </defs>

    <!-- grid guide -->
    <line x1="90" y1="25" x2="750" y2="25" class="axis"/>
    <line x1="90" y1="70" x2="750" y2="70" class="axis"/>
    <line x1="90" y1="115" x2="750" y2="115" class="axis"/>
    <line x1="90" y1="160" x2="750" y2="160" class="axis"/>
    <line x1="90" y1="205" x2="750" y2="205" class="axis"/>

    <!-- Row labels -->
    <text x="20" y="45"  class="lab">Fold 1</text>
    <text x="20" y="90"  class="lab">Fold 2</text>
    <text x="20" y="135" class="lab">Fold 3</text>
    <text x="20" y="180" class="lab">Fold 4</text>
    <text x="20" y="225" class="lab">Fold 5</text>

    <!-- Layout constants for 5 blocks -->
    <!-- Each row has five blocks; the i-th block in row i is the validation block. -->
    <!-- Row 1 -->
    <rect x="90"  y="30" width="126" height="28" class="blk val"/>
    <rect x="222" y="30" width="126" height="28" class="blk train"/>
    <rect x="354" y="30" width="126" height="28" class="blk train"/>
    <rect x="486" y="30" width="126" height="28" class="blk train"/>
    <rect x="618" y="30" width="126" height="28" class="blk train"/>

    <!-- Row 2 -->
    <rect x="90"  y="75" width="126" height="28" class="blk train"/>
    <rect x="222" y="75" width="126" height="28" class="blk val"/>
    <rect x="354" y="75" width="126" height="28" class="blk train"/>
    <rect x="486" y="75" width="126" height="28" class="blk train"/>
    <rect x="618" y="75" width="126" height="28" class="blk train"/>

    <!-- Row 3 -->
    <rect x="90"  y="120" width="126" height="28" class="blk train"/>
    <rect x="222" y="120" width="126" height="28" class="blk train"/>
    <rect x="354" y="120" width="126" height="28" class="blk val"/>
    <rect x="486" y="120" width="126" height="28" class="blk train"/>
    <rect x="618" y="120" width="126" height="28" class="blk train"/>

    <!-- Row 4 -->
    <rect x="90"  y="165" width="126" height="28" class="blk train"/>
    <rect x="222" y="165" width="126" height="28" class="blk train"/>
    <rect x="354" y="165" width="126" height="28" class="blk train"/>
    <rect x="486" y="165" width="126" height="28" class="blk val"/>
    <rect x="618" y="165" width="126" height="28" class="blk train"/>

    <!-- Row 5 -->
    <rect x="90"  y="210" width="126" height="28" class="blk train"/>
    <rect x="222" y="210" width="126" height="28" class="blk train"/>
    <rect x="354" y="210" width="126" height="28" class="blk train"/>
    <rect x="486" y="210" width="126" height="28" class="blk train"/>
    <rect x="618" y="210" width="126" height="28" class="blk val"/>
  </svg>
  </div>

  <p class="note" style="margin-top:14px;">
    In each fold, the pink block is held out for validation; the blue blocks are used for training. The model is refit K times,
    and validation scores are averaged. You then pick hyperparameters that perform best on average.
  </p>

</section>

<section id="kfold-figure-10">
  <h2>2) Visual: 10-Fold Cross-Validation</h2>
  <div class="legend">
    <span class="swatch train"></span> <span>Train folds</span>
    <span class="swatch val"></span> <span>Validation fold</span>
  </div>

  <div class="svgwrap">
  <!-- Inline SVG: 10 rows = 10 folds. Each row shows which chunk is validation (pink), others train (blue). -->
  <svg viewBox="0 0 900 460" width="100%" height="auto" role="img" aria-label="Ten-fold cross-validation diagram">
    <defs>
      <style>
        .blk { rx:4; ry:4; stroke:#0e0b10; stroke-width:1; }
        .train { fill:#6fc3df; }
        .val { fill:#ff79c6; }
        .lab { fill:#ffb3de; font: 600 13px 'Roboto', Arial, sans-serif; }
        .axis { stroke:#3a2f36; stroke-width:1; }
      </style>
    </defs>

    <!-- Row labels -->
    <text x="20" y="35"  class="lab">Fold 1</text>
    <text x="20" y="75"  class="lab">Fold 2</text>
    <text x="20" y="115" class="lab">Fold 3</text>
    <text x="20" y="155" class="lab">Fold 4</text>
    <text x="20" y="195" class="lab">Fold 5</text>
    <text x="20" y="235" class="lab">Fold 6</text>
    <text x="20" y="275" class="lab">Fold 7</text>
    <text x="20" y="315" class="lab">Fold 8</text>
    <text x="20" y="355" class="lab">Fold 9</text>
    <text x="20" y="395" class="lab">Fold 10</text>

    <!-- Each row has 10 blocks (one validation, 9 train). Block width shrinks to fit -->
    <!-- Row height/spacing -->
    <!-- Row 1 -->
    <rect x="90"  y="20" width="70" height="28" class="blk val"/>
    <rect x="162" y="20" width="70" height="28" class="blk train"/>
    <rect x="234" y="20" width="70" height="28" class="blk train"/>
    <rect x="306" y="20" width="70" height="28" class="blk train"/>
    <rect x="378" y="20" width="70" height="28" class="blk train"/>
    <rect x="450" y="20" width="70" height="28" class="blk train"/>
    <rect x="522" y="20" width="70" height="28" class="blk train"/>
    <rect x="594" y="20" width="70" height="28" class="blk train"/>
    <rect x="666" y="20" width="70" height="28" class="blk train"/>
    <rect x="738" y="20" width="70" height="28" class="blk train"/>

    <!-- Row 2 -->
    <rect x="90"  y="60" width="70" height="28" class="blk train"/>
    <rect x="162" y="60" width="70" height="28" class="blk val"/>
    <rect x="234" y="60" width="70" height="28" class="blk train"/>
    <rect x="306" y="60" width="70" height="28" class="blk train"/>
    <rect x="378" y="60" width="70" height="28" class="blk train"/>
    <rect x="450" y="60" width="70" height="28" class="blk train"/>
    <rect x="522" y="60" width="70" height="28" class="blk train"/>
    <rect x="594" y="60" width="70" height="28" class="blk train"/>
    <rect x="666" y="60" width="70" height="28" class="blk train"/>
    <rect x="738" y="60" width="70" height="28" class="blk train"/>

    <!-- Row 3 -->
    <rect x="90"  y="100" width="70" height="28" class="blk train"/>
    <rect x="162" y="100" width="70" height="28" class="blk train"/>
    <rect x="234" y="100" width="70" height="28" class="blk val"/>
    <rect x="306" y="100" width="70" height="28" class="blk train"/>
    <rect x="378" y="100" width="70" height="28" class="blk train"/>
    <rect x="450" y="100" width="70" height="28" class="blk train"/>
    <rect x="522" y="100" width="70" height="28" class="blk train"/>
    <rect x="594" y="100" width="70" height="28" class="blk train"/>
    <rect x="666" y="100" width="70" height="28" class="blk train"/>
    <rect x="738" y="100" width="70" height="28" class="blk train"/>

    <!-- Row 4 -->
    <rect x="90"  y="140" width="70" height="28" class="blk train"/>
    <rect x="162" y="140" width="70" height="28" class="blk train"/>
    <rect x="234" y="140" width="70" height="28" class="blk train"/>
    <rect x="306" y="140" width="70" height="28" class="blk val"/>
    <rect x="378" y="140" width="70" height="28" class="blk train"/>
    <rect x="450" y="140" width="70" height="28" class="blk train"/>
    <rect x="522" y="140" width="70" height="28" class="blk train"/>
    <rect x="594" y="140" width="70" height="28" class="blk train"/>
    <rect x="666" y="140" width="70" height="28" class="blk train"/>
    <rect x="738" y="140" width="70" height="28" class="blk train"/>

    <!-- Row 5 -->
    <rect x="90"  y="180" width="70" height="28" class="blk train"/>
    <rect x="162" y="180" width="70" height="28" class="blk train"/>
    <rect x="234" y="180" width="70" height="28" class="blk train"/>
    <rect x="306" y="180" width="70" height="28" class="blk train"/>
    <rect x="378" y="180" width="70" height="28" class="blk val"/>
    <rect x="450" y="180" width="70" height="28" class="blk train"/>
    <rect x="522" y="180" width="70" height="28" class="blk train"/>
    <rect x="594" y="180" width="70" height="28" class="blk train"/>
    <rect x="666" y="180" width="70" height="28" class="blk train"/>
    <rect x="738" y="180" width="70" height="28" class="blk train"/>

    <!-- Row 6 -->
    <rect x="90"  y="220" width="70" height="28" class="blk train"/>
    <rect x="162" y="220" width="70" height="28" class="blk train"/>
    <rect x="234" y="220" width="70" height="28" class="blk train"/>
    <rect x="306" y="220" width="70" height="28" class="blk train"/>
    <rect x="378" y="220" width="70" height="28" class="blk train"/>
    <rect x="450" y="220" width="70" height="28" class="blk val"/>
    <rect x="522" y="220" width="70" height="28" class="blk train"/>
    <rect x="594" y="220" width="70" height="28" class="blk train"/>
    <rect x="666" y="220" width="70" height="28" class="blk train"/>
    <rect x="738" y="220" width="70" height="28" class="blk train"/>

    <!-- Row 7 -->
    <rect x="90"  y="260" width="70" height="28" class="blk train"/>
    <rect x="162" y="260" width="70" height="28" class="blk train"/>
    <rect x="234" y="260" width="70" height="28" class="blk train"/>
    <rect x="306" y="260" width="70" height="28" class="blk train"/>
    <rect x="378" y="260" width="70" height="28" class="blk train"/>
    <rect x="450" y="260" width="70" height="28" class="blk train"/>
    <rect x="522" y="260" width="70" height="28" class="blk val"/>
    <rect x="594" y="260" width="70" height="28" class="blk train"/>
    <rect x="666" y="260" width="70" height="28" class="blk train"/>
    <rect x="738" y="260" width="70" height="28" class="blk train"/>

    <!-- Row 8 -->
    <rect x="90"  y="300" width="70" height="28" class="blk train"/>
    <rect x="162" y="300" width="70" height="28" class="blk train"/>
    <rect x="234" y="300" width="70" height="28" class="blk train"/>
    <rect x="306" y="300" width="70" height="28" class="blk train"/>
    <rect x="378" y="300" width="70" height="28" class="blk train"/>
    <rect x="450" y="300" width="70" height="28" class="blk train"/>
    <rect x="522" y="300" width="70" height="28" class="blk train"/>
    <rect x="594" y="300" width="70" height="28" class="blk val"/>
    <rect x="666" y="300" width="70" height="28" class="blk train"/>
    <rect x="738" y="300" width="70" height="28" class="blk train"/>

    <!-- Row 9 -->
    <rect x="90"  y="340" width="70" height="28" class="blk train"/>
    <rect x="162" y="340" width="70" height="28" class="blk train"/>
    <rect x="234" y="340" width="70" height="28" class="blk train"/>
    <rect x="306" y="340" width="70" height="28" class="blk train"/>
    <rect x="378" y="340" width="70" height="28" class="blk train"/>
    <rect x="450" y="340" width="70" height="28" class="blk train"/>
    <rect x="522" y="340" width="70" height="28" class="blk train"/>
    <rect x="594" y="340" width="70" height="28" class="blk train"/>
    <rect x="666" y="340" width="70" height="28" class="blk val"/>
    <rect x="738" y="340" width="70" height="28" class="blk train"/>

    <!-- Row 10 -->
    <rect x="90"  y="380" width="70" height="28" class="blk train"/>
    <rect x="162" y="380" width="70" height="28" class="blk train"/>
    <rect x="234" y="380" width="70" height="28" class="blk train"/>
    <rect x="306" y="380" width="70" height="28" class="blk train"/>
    <rect x="378" y="380" width="70" height="28" class="blk train"/>
    <rect x="450" y="380" width="70" height="28" class="blk train"/>
    <rect x="522" y="380" width="70" height="28" class="blk train"/>
    <rect x="594" y="380" width="70" height="28" class="blk train"/>
    <rect x="666" y="380" width="70" height="28" class="blk train"/>
    <rect x="738" y="380" width="70" height="28" class="blk val"/>
  </svg>
  </div>

  <p class="note" style="margin-top:14px;">
    With 10 folds, each block is smaller. This gives more validation runs (10 instead of 5), which usually means
    a lower-bias estimate of model performance, though at the cost of more computation. Along with 5-fold CV,
    10-fold CV is one of the most widely used settings in applied machine learning.
  </p>
</section>


<section id="cv-code">
  <h2>3) Simple CV: <code>RidgeCV</code>, <code>LassoCV</code>, <code>ElasticNetCV</code></h2>
  <p>
      These estimators run cross-validation internally to choose the best hyperparameters. We still keep them inside a
      <code class="inline">Pipeline</code> with <code class="inline">StandardScaler</code> to avoid leakage.
    </p>
    <pre><button class="copy">Copy</button><code># Import libraries
import numpy as np
import pandas as pd

# Dataset: California housing (regression problem)
from sklearn.datasets import fetch_california_housing
from sklearn.model_selection import train_test_split

# Build ML pipeline: scaling + model
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler

# Linear models with built-in CV
from sklearn.linear_model import LinearRegression, RidgeCV, LassoCV, ElasticNetCV

# Metrics
from sklearn.metrics import mean_squared_error, r2_score

# Set random seed for reproducibility
RANDOM_STATE = 42
np.random.seed(RANDOM_STATE)

# --------------------------------------------------------
# 1. Load dataset
# --------------------------------------------------------
D = fetch_california_housing(as_frame=True)   # returns data + target as pandas DataFrame
X, y = D.data, D.target                       # X = features, y = house price target

# Split into train (80%) and test (20%)
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=RANDOM_STATE, shuffle=True
)

# --------------------------------------------------------
# 2. Define evaluation helper function
# --------------------------------------------------------
def evaluate_model(name, model, X_train, y_train, X_test, y_test):
    """
    Fits model, predicts on train/test, and returns a DataFrame with metrics:
    SSE, MSE, RMSE, R¬≤.
    """
    model.fit(X_train, y_train)   # train the model
    ytr = model.predict(X_train)  # predictions on train
    yte = model.predict(X_test)   # predictions on test
    
    # inner helper for computing metrics per split
    def rows(split, yt, yp):
        mse = mean_squared_error(yt, yp)
        return {
            "Model": name,
            "Split": split,
            "SSE": np.sum((yt - yp)**2),  # sum of squared errors
            "MSE": mse,                   # mean squared error
            "RMSE": np.sqrt(mse),         # root mean squared error
            "R^2": r2_score(yt, yp)       # coefficient of determination
        }
    
    # Collect results for Train and Test
    return pd.DataFrame([
        rows("Train", y_train, ytr),
        rows("Test", y_test, yte)
    ])

# --------------------------------------------------------
# 3. Define models (each inside a Pipeline with StandardScaler)
# --------------------------------------------------------

# Baseline OLS regression
ols = Pipeline([
    ("scaler", StandardScaler()), 
    ("lr", LinearRegression())
])

# Ridge regression with cross-validation (tunes alpha)
ridge = Pipeline([
    ("scaler", StandardScaler()),
    ("ridge", RidgeCV(alphas=np.logspace(-3, 3, 50), cv=5))
])

# Lasso regression with cross-validation (tunes alpha)
lasso = Pipeline([
    ("scaler", StandardScaler()),
    ("lasso", LassoCV(
        alphas=np.logspace(-3, 1, 50),  # test a grid of alpha values
        cv=5,                           # 5-fold cross-validation
        max_iter=10000, 
        random_state=RANDOM_STATE
    ))
])

# Elastic Net regression with cross-validation (tunes alpha & l1_ratio)
elastic = Pipeline([
    ("scaler", StandardScaler()),
    ("en", ElasticNetCV(
        alphas=np.logspace(-3, 1, 30),   # alpha grid
        l1_ratio=[0.1,0.3,0.5,0.7,0.9], # mix between L1 and L2 penalty
        cv=5, 
        max_iter=10000, 
        random_state=RANDOM_STATE
    ))
])

# --------------------------------------------------------
# 4. Evaluate all models and combine results
# --------------------------------------------------------
results = pd.concat([
    evaluate_model("OLS", ols, X_train, y_train, X_test, y_test),
    evaluate_model("RidgeCV", ridge, X_train, y_train, X_test, y_test),
    evaluate_model("LassoCV", lasso, X_train, y_train, X_test, y_test),
    evaluate_model("ElasticNetCV", elastic, X_train, y_train, X_test, y_test)
]).set_index(["Model", "Split"])

# Show metrics table
print(results)

# --------------------------------------------------------
# 5. Display best hyperparameters chosen by CV
# --------------------------------------------------------
print("Best Ridge alpha  :", ridge.named_steps["ridge"].alpha_)
print("Best Lasso alpha  :", lasso.named_steps["lasso"].alpha_)
print("Best EN alpha     :", elastic.named_steps["en"].alpha_)
print("Best EN l1_ratio  :", elastic.named_steps["en"].l1_ratio_)</code></pre>

    <p class="note">
      Tip: For classification, prefer <code class="inline">StratifiedKFold</code> to keep class balance per fold.
    </p>
  </section>

  
  <section id="cv-alpha-selection">
  <h2>4) How CV Picks the Best <code>alpha</code></h2>
  <p>
    For models like <code class="inline">LassoCV</code>, <code class="inline">RidgeCV</code>, and
    <code class="inline">ElasticNetCV</code>, the regularization strength <code class="inline">alpha</code>
    is not chosen manually. Instead, cross-validation is used to automatically find the value of
    <code class="inline">alpha</code> that yields the best performance.
  </p>
  <ul>
    <li><b>Step 1:</b> Pick a candidate <code class="inline">alpha</code> from the grid.</li>
    <li><b>Step 2:</b> Run <em>5-fold cross-validation</em>:
      <ul>
        <li>Split the training set into 5 folds.</li>
        <li>Train on 4 folds, validate on the remaining 1 fold.</li>
        <li>Repeat until each fold has served as the validation set once.</li>
      </ul>
    </li>
    <li><b>Step 3:</b> Compute 5 validation errors for this <code class="inline">alpha</code> and average them.</li>
    <li><b>Step 4:</b> Repeat Steps 1‚Äì3 for every candidate <code class="inline">alpha</code>.</li>
    <li><b>Step 5:</b> Choose the <code class="inline">alpha</code> with the <strong>smallest average validation error</strong>.</li>
  </ul>
  <p class="note">
    üëâ Each <code class="inline">alpha</code> ‚Üí 5 validation errors (from the 5 folds) ‚Üí average them ‚Üí keep the average.<br>
    After looping through all alphas, the one with the smallest average validation error is chosen as the best (<code class="inline">alpha_</code>).
  </p>
</section>

  
  <script>
    document.querySelectorAll("pre .copy").forEach(button => {
      button.addEventListener("click", () => {
        const code = button.nextElementSibling.innerText;
        navigator.clipboard.writeText(code).then(() => {
          const old = button.textContent;
          button.textContent = "Copied!";
          setTimeout(() => button.textContent = old, 1500);
        });
      });
    });
  </script>

  </body>
  </html>
